#
## This file is maintained by puppet. Manual changes will be overwritten.
## Add entries using Puppet.
#

## Define Users to be authed by PAM

<% if @users != 'NONE' -%>
<% users.each_pair do |user, values| -%>
user = <%= user %> {
  <%- if values -%>
  <%- if values.has_key?('member') -%>
  member = <%= values['member'] %>
  <%- else -%>
  member = <%= @default_group %>
  <%- end -%>
  <%- if values.has_key?('password') -%>
  login = des <%= values['password'] %>
  pap = des <%= values['password'] %>
  <%- end -%>
  <%- if values.has_key?('cmd') -%>
  <%- values['cmd'].each_pair do |cmd, perms| -%>
  cmd = "<%= cmd -%>" {
  <%- perms.each do |perm| -%>
  <%- perm.each_pair do |permission, regex| -%>
    <%= permission -%> "<%= regex %>"
  <%- end -%>
  <%- end -%>
  }
  <%- end -%>
  <%- end -%>
  <%- else -%>
  member = <%= @default_group %>
  <%- end -%>
}
<% end -%>
<% end -%>

<% if @localusers != 'NONE' -%>
<% localusers.each_pair do |user, values| -%>
user = <%= user %> {
  <%- if values -%>
  <%- if values.has_key?('member') -%>
  member = <%= values['member'] %>
  <%- else -%>
  member = <%= @default_group %>
  <%- end -%>
  <%- if values.has_key?('password') -%>
  login = des <%= values['password'] %>
  pap = des <%= values['password'] %>
  <%- end -%>
  <%- if values.has_key?('cmd') -%>
  <%- values['cmd'].each_pair do |cmd, perms| -%>
  cmd = "<%= cmd -%>" {
  <%- perms.each do |perm| -%>
  <%- perm.each_pair do |permission, regex| -%>
    <%= permission -%> "<%= regex %>"
  <%- end -%>
  <%- end -%>
  }
  <%- end -%>
  <%- end -%>
  <%- else -%>
  member = <%= @default_group %>
  <%- end -%>
}
<% end -%>
<% end -%>
key = "<%= @tac_key %>"

group = show_only {
        default service = deny
        login = PAM
        pap = PAM
        service = junos-exec {
                local-user-name = remote
                allow-commands = "(show .*)|exit"
                allow-configuration = ""
                deny-commands = ".*"
                deny-configuration = ""
        }
}

# Admin users
group = all_access {
    default service = permit
    login = PAM
    pap   = PAM

    # JunOS related settings
    service = junos-exec {
        local-user-name = remote
        allow-commands = ".*"
        allow-configuration = ".*"
        deny-commands = ""
        deny-configuration = ""
    }
    service = exec {
    priv-lvl = 15
    cisco-av-pair="shell:roles=network-admin"
    }
}

